---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';
import { getSession, signIn, signOut } from 'auth-astro/client';

const session = await getSession();
---

<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			main {
				width: 100%;
				max-width: 100%;
				margin: 0;
				padding: 3rem 0;
				background: var(--theme-bg);
				color: var(--theme-text);
			}
			.content {
				width: 720px;
				max-width: calc(100% - 2em);
				margin: auto;
				padding: 1em;
				text-align: center;
			}
			.auth-container {
				background: var(--theme-bg-accent);
				border-radius: 0.75rem;
				padding: 2rem;
				margin: 2rem auto;
				max-width: 400px;
			}
			.auth-title {
				font-size: 1.5em;
				margin-bottom: 1rem;
				color: var(--theme-text);
			}
			.auth-description {
				color: var(--theme-text-light);
				margin-bottom: 2rem;
				font-size: 0.9em;
			}
			.auth-button {
				display: inline-flex;
				align-items: center;
				gap: 0.5rem;
				background: var(--theme-bg);
				color: var(--theme-text);
				border: 1px solid var(--theme-divider);
				padding: 0.75rem 1.5rem;
				border-radius: 0.5rem;
				font-size: 1em;
				cursor: pointer;
				transition: all 0.2s ease;
			}
			.auth-button:hover {
				background: var(--accent);
				color: white;
				border-color: var(--accent);
			}
			.auth-button svg {
				width: 20px;
				height: 20px;
			}
			.user-info {
				margin-top: 1rem;
				padding-top: 1rem;
				border-top: 1px solid var(--theme-divider);
			}
		</style>
	</head>

	<body>
		<Header />
		<main>
			<div class="content">
				<div class="auth-container">
					{!session ? (
						<>
							<h1 class="auth-title">Builder Login</h1>
							<p class="auth-description">
								Sign in with GitHub to start documenting your journey on The Builders Log.
							</p>
							<button class="auth-button" onclick="signIn('github')">
								<svg viewBox="0 0 16 16" aria-hidden="true">
									<path
										fill="currentColor"
										d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"
									></path>
								</svg>
								Sign in with GitHub
							</button>
						</>
					) : (
						<>
							<h1 class="auth-title">Welcome, {session.user?.name}!</h1>
							<p class="auth-description">
								You're signed in and ready to start documenting your journey.
							</p>
							<button class="auth-button" onclick="signOut()">Sign out</button>
							<div class="user-info">
								<a href="/buddy" class="auth-button">Start Builder Interview</a>
							</div>
						</>
					)}
				</div>
			</div>
		</main>
		<Footer />

		<script>
			// Import auth functions
			const { signIn, signOut } = window.AuthAstro;
		</script>
	</body>
</html>
